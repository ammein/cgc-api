function update(e,t,n,o,a,i){$.ajax({method:"PATCH",url:"/api/question/"+e,contentType:"application/json",data:JSON.stringify({id:e,questionString:t,answers:n,level:o,time:a}),success:function(e){return $("#questionsBlock").empty(),i?getQueryLink(i):initialize()}})}function deleteData(e,t,n){$.ajax({method:"DELETE",url:"/api/question/"+e,contentType:"application/json",data:JSON.stringify({id:e}),success:function(e){return $("#questionsBlock").empty(),n?getQueryLink(n):initialize()}})}function getQueryLink(e){return $.ajax({method:"GET",url:"/api/question/?q="+encodeURIComponent(e),contentType:"application/json",success:function(t){var n=$("#questionsBlock");$("#questionsBlock").empty(),t.question.docs.forEach(function(e){var t=e._id;n.append("<form id='"+t+"' class='questionBox'><input type='number' name='time' id='timeLittleBox' value='"+e.time+"' onfocus='this.value=\"\"'><p style='font-size: 17px;color: #535353; display: inline-block; float:right; padding:3px;'>seconds</p><textarea class='list'>"+e.questionString+"</textarea><input type='number' class='answer-box-edit' style='background-color: #84ccf3' id='trueAnswerBox' value='"+e.answers[0]+"'><input type='number' class='answer-box-edit' id='falseAnswerBox1' value='"+e.answers[1]+"'><input type='number' class='answer-box-edit' id='falseAnswerBox2' value='"+e.answers[2]+"'><input type='number' class='answer-box-edit' id='falseAnswerBox3' value='"+e.answers[3]+"'><div class='form-group'><label for='level' id='timeBoxLabelEdit'>Level of Question = <output class='rangeValue' id='rangevalue'>"+e.level+"</output></div></label><input type='range' id='level' min='1' max='10' value='"+e.level+"' oninput='rangevalue.value=value' onchange='rangevalue.value=value' /><br><button form='"+t+"' class='delete'>Delete</button><button form='"+t+"' class='update'>Update</button></form><hr>")}),t.question.total>=6&&n.last().append("<div id='pagination' class='pagination'><a class='left-arrow' href='/'>❮ Previous</a><a class='right-arrow' href='/'>Next ❯</a></div>"),1==t.question.page?$(".left-arrow").addClass("disabled"):t.question.page==t.question.pages&&$(".right-arrow").addClass("disabled"),$("a.left-arrow").on("click",function(e){e.preventDefault(),paginationLeft(t.question.pages,t.question.page)}),$("a.right-arrow").on("click",function(e){e.preventDefault(),paginationRight(t.question.pages,t.question.page)}),$(".questionBox").on("click",".update",function(t){t.preventDefault();var n=$(this).attr("form");update(n,$("form#"+n).find("textarea").val(),[$("form#"+n).find("#trueAnswerBox").val(),$("form#"+n).find("#falseAnswerBox1").val(),$("form#"+n).find("#falseAnswerBox2").val(),$("form#"+n).find("#falseAnswerBox3").val()],$("form#"+n).find("#level").val(),$("form#"+n).find("#timeLittleBox").val(),e)}),$(".questionBox").on("click",".delete",function(t){t.preventDefault();var n=$(this).attr("form");deleteData(n,$("form#"+n).find("textarea").val(),e)})}})}function paginationLeft(e,t){return 1==t?getQueryLink(JSON.parse(t)):t>=1?getQueryLink(JSON.parse(t-1)):void 0}function paginationRight(e,t){return t==e?getQueryLink(JSON.parse(t)):t<=e?getQueryLink(JSON.parse(t+1)):void 0}function initialize(){return $.ajax({method:"GET",url:"/api/question",contentType:"application/json",success:function(e){var t=$("#questionsBlock");e.question.docs.forEach(function(e){var n=e._id;t.append("<form id='"+n+"' class='questionBox'><input type='number' name='time' id='timeLittleBox' value='"+e.time+"' onfocus='this.value=\"\"'><p style='font-size: 17px;color: #535353; display: inline-block; float:right; padding:3px;'>seconds</p><textarea class='list'>"+e.questionString+"</textarea><input type='number' style='background-color: #84ccf3' class='answer-box-edit' id='trueAnswerBox' value='"+e.answers[0]+"'><input type='number' class='answer-box-edit' id='falseAnswerBox1' value='"+e.answers[1]+"'><input type='number' class='answer-box-edit' id='falseAnswerBox2' value='"+e.answers[2]+"'><input type='number' class='answer-box-edit' id='falseAnswerBox3' value='"+e.answers[3]+"'><div class='form-group'><label for='level' id='timeBoxLabelEdit'>Level of Question = <output class='rangeValue' id='rangevalue'>"+e.level+"</output></div></label><input type='range' id='level' min='1' max='10' value='"+e.level+"' oninput='rangevalue.value=value' onchange='rangevalue.value=value' /><br><button form='"+n+"' class='delete'>Delete</button><button form='"+n+"' class='update'>Update</button></form><hr>")}),e.question.total>=6&&t.last().append("<div id='pagination' class='pagination'><a class='left-arrow' href='/'>❮ Previous</a><a class='right-arrow' href='/'>Next ❯</a></div>"),1==e.question.page?$(".left-arrow").addClass("disabled"):e.question.page==e.question.pages&&$(".right-arrow").addClass("disabled"),$("a.left-arrow").on("click",function(t){t.preventDefault(),paginationLeft(e.question.pages,e.question.page)}),$("a.right-arrow").on("click",function(t){t.preventDefault(),paginationRight(e.question.pages,e.question.page)}),$(".questionBox").on("click",".update",function(e){e.preventDefault();var t=$(this).attr("form");update(t,$("form#"+t).find("textarea").val(),[$("form#"+t).find("#trueAnswerBox").val(),$("form#"+t).find("#falseAnswerBox1").val(),$("form#"+t).find("#falseAnswerBox2").val(),$("form#"+t).find("#falseAnswerBox3").val()],$("form#"+t).find("#level").val(),$("form#"+t).find("#timeLittleBox").val())}),$(".questionBox").on("click",".delete",function(e){e.preventDefault();var t=$(this).attr("form");deleteData(t,$("form#"+t).find("textarea").val())})}})}function closeBox(){$("#questionsBlock").empty(),$(".all-question").css("display","none"),$(".sidebar").css({width:"0%",transitionDuration:"0.4s"}),$(".overlay").css({display:"none",transitionDuration:"0.2s"})}function openBox(){$(".sidebar").css({display:"block",width:"55%",transitionDuration:"0.4s"}),$(".all-question").css("display","block"),$(".overlay").css({display:"block",transitionDuration:"0.2s"}),initialize()}function rankClick(){console.log("Clicked"),$("#rankbox").css({width:"100%",transition:"2s ease-in",position:"absolute",float:"right",backgroundColor:"rgba(0,0,0,0.85)",display:"block",bottom:"0",top:"0",zIndex:"3",left:"0"}),$.ajax({url:"/api/app/user",contentType:"application/json",method:"GET",success:function(e){var t,n=1,o=0;e.users.forEach(function(e){e.answers.forEach(e=>e?o++:e);t=100*o/e.answers.length,console.log("Percentage :",t),$("tbody#appendTable").append(`<tr style='${getCookie("from")===e.from?"background-color :rgba(2, 60, 255, 0.41);":"background-color :none;"}'><td> ${n++} </td><td> ${e.from}</td><td>${isNaN(t)||t==1/0?t=0:t}/100</td></tr>`)})}}),$(".rank-chat").on("click",function(e){$("#rankbox").css({width:"0%",transition:"1s ease-in",display:"none"}),$("tbody#appendTable").empty()})}function getCookie(e){for(var t=e+"=",n=document.cookie.split(";"),o=0;o<n.length;o++){for(var a=n[o];" "==a.charAt(0);)a=a.substring(1);if(0==a.indexOf(t))return a.substring(t.length,a.length)}return""}function checkCookie(){var e=getCookie("from");""!=e&&($("div#formInput").append("<a class='fetchUser' href='/play'> Use \""+decodeURI(e)+'"</a>'),$("#welcome").append(decodeURI(e)))}function gameStarted(e){$.ajax({url:"/api/game/"+encodeURI(e),method:"GET",contentType:"application/json",success:function(e){gameCounter(e.question,0)}})}function gameCounter(e,t){window.clearInterval(window.timeTrue),Array.prototype.move=function(e,t){this.splice(t,0,this.splice(e,1)[0])};for(var n=e[t].answers,o=[],a=0;a<n.length;a++)o.push(n[a]);var i=Math.floor(3*Math.random()+1),s=Math.floor(4*Math.random()-1),r=Math.floor(3*Math.random()+1);o.move(0,i),o.move(1,s),o.move(2,r),$(".append").html("<div id='level-text' class='level-text'><p style='text-align:center;'>Level "+e[t].level+"</p></div><div id='countdown'><div id='countdown-number'></div><svg><circle class='circle' cx='75' cy='80' r='68' /></svg></div><div id='"+e[t]._id+"' class='question-display'>"+e[t].questionString+"</div><div class='input-area'><input type='submit' id='answer1' value='"+o[0]+"'><input type='submit' id='answer2' value='"+o[1]+"'><br><input type='submit' id='answer3' value='"+o[2]+"'><input type='submit' id='answer4' value='"+o[3]+"'></div><div id='new-user' class='new-user'></div>");var l=document.getElementById("countdown-number"),u=e[t].time;l.textContent=u,window.timeTrue=window.setInterval(function(){console.log("Countdown :",u),0===u?(pushAnswer(getCookie("from"),e[t].answers[0],"false",e[t].level,timeTrue),window.clearInterval(window.timeTrue),gameCounter(e,t+1),u=0):u=--u,l.textContent=u},1e3),$(".circle").css({animation:"countdown "+u+"s linear forwards",animationPlayState:"running"}),$("button#chat").on("click",function(n){window.clearInterval(window.timeTrue),$(".circle").css({animationPlayState:"paused"}),$("div#close-chat").on("click",function(n){n.stopPropagation(),window.clearInterval(window.timeTrue),gameCounter(e,t)})});for(a=1;a<=4;a++)!function(n){$("#answer"+n).on("click",function(){var n=this.value;pushAnswer(getCookie("from"),e[t].answers[0],n,e[t].level,timeTrue),gameCounter(e,t+1),clearInterval(timeTrue)})}(a)}var allAnswer=[];function pushAnswer(e,t,n,o,a){console.log("All Answer",allAnswer),n==t?allAnswer.push(!0):n!==t?allAnswer.push(!1):"false"==n&&allAnswer.push(!1),5===allAnswer.length&&(sendAnswer(allAnswer,e,o,a),allAnswer=[])}var finalAnswer=[],allLevel=[];function sendAnswer(e,t,n,o){console.log("Final Answer",finalAnswer);for(var a=0;a<e.length;a++)finalAnswer.push(e[a]),allLevel.push(n);$.ajax({url:"api/app/user/"+t,method:"PATCH",contentType:"application/json",data:JSON.stringify({answers:finalAnswer,level:allLevel}),success:function(){console.log("Success TRUE PATCH"),$(".append").empty();var e=n+1;window.clearInterval(window.timeTrue),gameStarted(e)}})}function getTime(){var e={},t=new Date;return e.hours=t.getHours()>12?t.getHours()-12:0===t.getHours()?t.getHours()+1:t.getHours(),e.minutes=t.getMinutes()<10?"0"+t.getMinutes():t.getMinutes(),e.ampm=t.getHours()>=12?"pm":"am",e}$(function(){$("#level").val(1);if(console.log("I loaded in browser"),$(".textarea-box").one("click",function(){$(".textarea-box").val(""),$(".textarea-box").css({color:"#2e2e2e"})}),$(document).on("click","button#chat",function(e){console.log("Clicked"),$("#chatbox").css({width:"100%",transition:"2s ease-in",position:"absolute",float:"right",backgroundColor:"rgba(0,0,0,0.85)",display:"block",bottom:"0",top:"0",zIndex:"3",left:"0",paddingBottom:"120px"}),$(".close-chat").on("click",function(e){e.stopPropagation(),$("#chatbox").css({width:"0%",transition:"1s ease-in",display:"none"})})}),$("#inputSend").submit(function(e){e.preventDefault();var t=$("input#from").val();$("p").remove(),$.ajax({url:"/api/app/user/input",method:"POST",data:JSON.stringify({from:t}),contentType:"application/json",success:function(){$(this).unbind("submit").submit(),window.location.href="/play"},error:function(e){console.log(e),$("#input").append("<p style='top : 0;font-size : 14px;color: white;background: #ff2457;text-align:  center;'>\""+e.responseJSON.op.from+'" has been taken. Please choose other names.</p>')}})}),"/play"==window.location.pathname){gameStarted(1);var e=io();e.on("connect",function(){console.log("Connected to Server")}),e.on("newUser",function(e){var t=$(".new-user");t.slideDown(500,function(){t.css("display","table"),$(".user-welcome").css("display","block")}),t.html("<p class='user-welcome'>User Connected : "+e.from+"</p>"),setTimeout(()=>{t.slideUp(500,function(){$(".user-welcome").css("display","none")})},5e3)}),e.on("userDisconnect",function(e){var t=$(".new-user");t.slideDown(500,function(){t.css({display:"table",backgroundColor:"red"}),$(".user-welcome").css("display","block")}),t.html("<p class='user-welcome'>User Disconnected : "+e+"</p>"),setTimeout(()=>{t.slideUp(500,function(){$(".user-welcome").css("display","none")})},5e3)});var t=$("#chatmessages");e.on("newMessages",function(e){var n=$("<li class='bubble-you'></li>"),o=$("<li class='bubble-bot' style='color : #6ef058;'></li>"),a=$("<p class='time' style='clear:both; float:right;'></p>"),i=$("<p class='time'></p>"),s=$("<p style='clear: both; float: right; margin-bottom: 0; font-size: 12px;'></p>"),r=$("<p style='clear: both; margin-bottom: 0; font-size: 12px;'></p>");getCookie("from")===e.user?(s.text("YOU"),n.text(`${e.chat}`),a.text(`${getTime().hours} : ${getTime().minutes} ${getTime().ampm}`),t.append(n),a.insertAfter(n),s.insertBefore(n),console.log("From YOU :",e)):(r.text(`${e.user}`),o.text(`${e.chat}`),i.text(`${getTime().hours} : ${getTime().minutes} ${getTime().ampm}`),t.append(o),i.insertAfter(o),r.insertBefore(o),console.log("From Other Users :",e)),$("#chatmessages").scrollTop($("#chatmessages")[0].scrollHeight)}),$("form#sendMessage").on("submit",function(t){var n=$("#chatarea").val();e.emit("createMessages",n),$("#chatarea").val(""),t.preventDefault()})}});